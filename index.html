<!doctype html><html lang=fr class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Atelier Spark SparkSQL"><meta name=author content="Hmida Hmida"><link rel=canonical href=https://hhmida.github.io/tp-spark/index.html><link rel=next href=submitting.html><link rel=icon href=assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.9"><title>Calcul Distribué avec Spark</title><link rel=stylesheet href=assets/stylesheets/main.f2e4d321.min.css><link rel=stylesheet href=assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=assets/stylesheets/extra.css><script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-QJTFFQBDR6"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-QJTFFQBDR6",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-QJTFFQBDR6",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#calcul-distribue-avec-spark class=md-skip> Aller au contenu </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=En-tête> <a href=index.html title="Calcul Distribué avec Spark" class="md-header__button md-logo" aria-label="Calcul Distribué avec Spark" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.812 0c-.425.013-.845.215-1.196.605a3.593 3.593 0 0 0-.493.722c-.355.667-.425 1.415-.556 2.143a551.9 551.9 0 0 0-.726 4.087c-.027.16-.096.227-.244.273C5.83 8.386 4.06 8.94 2.3 9.514a4.874 4.874 0 0 0-1.114.506c-1.042.665-1.196 1.753-.415 2.71.346.422.79.715 1.284.936 1.1.49 2.202.976 3.3 1.47.019.01.036.013.053.019h-.004l1.306.535c0 .023.002.045 0 .073-.2 2.03-.39 4.063-.58 6.095-.04.419-.012.831.134 1.23.317.87 1.065 1.148 1.881.701.372-.204.666-.497.937-.818 1.372-1.623 2.746-3.244 4.113-4.872.111-.133.205-.15.363-.098.349.117.697.231 1.045.347h.001c.02.012.045.02.073.03l.142.042c1.248.416 2.68.775 3.929 1.19.4.132.622.164 1.045.098.311-.048.592-.062.828-.236.602-.33.995-.957.988-1.682-.005-.427-.154-.813-.35-1.186-.82-1.556-1.637-3.113-2.461-4.666-.078-.148-.076-.243.037-.375 1.381-1.615 2.756-3.236 4.133-4.855.272-.32.513-.658.653-1.058.308-.878-.09-1.57-1-1.741a2.783 2.783 0 0 0-1.235.069c-1.974.521-3.947 1.041-5.918 1.57-.175.047-.26.015-.355-.144a353.08 353.08 0 0 0-2.421-4.018 4.61 4.61 0 0 0-.652-.849c-.371-.37-.802-.549-1.227-.536zm.172 3.703a.592.592 0 0 1 .189.211c.87 1.446 1.742 2.89 2.609 4.338.07.118.135.16.277.121 1.525-.41 3.052-.813 4.579-1.217.367-.098.735-.193 1.103-.289a.399.399 0 0 1-.1.2c-1.259 1.48-2.516 2.962-3.779 4.438-.11.13-.12.22-.04.37.937 1.803 1.768 3.309 2.498 4.76l-3.696-1.019c-.538-.18-1.077-.358-1.615-.539-.163-.055-.25-.03-.36.1-1.248 1.488-2.504 2.97-3.759 4.454a.398.398 0 0 1-.18.132c.035-.378.068-.757.104-1.136.149-1.572.297-3.144.451-4.716-.03-.318.117-.405-.322-.545-1.493-.593-3.346-1.321-4.816-1.905a.595.595 0 0 1 .24-.134c1.797-.57 3.595-1.14 5.394-1.705.127-.04.199-.092.211-.233.013-.148.05-.294.076-.441.241-1.363.483-2.726.726-4.088.068-.386.14-.771.21-1.157z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Calcul Distribué avec Spark </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Introduction </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=red aria-label="Basculer au mode sombre" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Basculer au mode sombre" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=red aria-label="Basculer au mode clair" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Basculer au mode clair" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Rechercher placeholder=Rechercher autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Recherche> <button type=reset class="md-search__icon md-icon" title=Effacer aria-label=Effacer tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initialisation de la recherche </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=Onglets data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class="md-tabs__item md-tabs__item--active"> <a href=index.html class=md-tabs__link> Introduction </a> </li> <li class=md-tabs__item> <a href=submitting.html class=md-tabs__link> Créer des applications Spark </a> </li> <li class=md-tabs__item> <a href=rdd.html class=md-tabs__link> Manipuler les RDD </a> </li> <li class=md-tabs__item> <a href=sparksql.html class=md-tabs__link> SparkSQL </a> </li> <li class=md-tabs__item> <a href=streaming.html class=md-tabs__link> Spark Streaming </a> </li> <li class=md-tabs__item> <a href=solutions.html class=md-tabs__link> Solutions </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=index.html title="Calcul Distribué avec Spark" class="md-nav__button md-logo" aria-label="Calcul Distribué avec Spark" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.812 0c-.425.013-.845.215-1.196.605a3.593 3.593 0 0 0-.493.722c-.355.667-.425 1.415-.556 2.143a551.9 551.9 0 0 0-.726 4.087c-.027.16-.096.227-.244.273C5.83 8.386 4.06 8.94 2.3 9.514a4.874 4.874 0 0 0-1.114.506c-1.042.665-1.196 1.753-.415 2.71.346.422.79.715 1.284.936 1.1.49 2.202.976 3.3 1.47.019.01.036.013.053.019h-.004l1.306.535c0 .023.002.045 0 .073-.2 2.03-.39 4.063-.58 6.095-.04.419-.012.831.134 1.23.317.87 1.065 1.148 1.881.701.372-.204.666-.497.937-.818 1.372-1.623 2.746-3.244 4.113-4.872.111-.133.205-.15.363-.098.349.117.697.231 1.045.347h.001c.02.012.045.02.073.03l.142.042c1.248.416 2.68.775 3.929 1.19.4.132.622.164 1.045.098.311-.048.592-.062.828-.236.602-.33.995-.957.988-1.682-.005-.427-.154-.813-.35-1.186-.82-1.556-1.637-3.113-2.461-4.666-.078-.148-.076-.243.037-.375 1.381-1.615 2.756-3.236 4.133-4.855.272-.32.513-.658.653-1.058.308-.878-.09-1.57-1-1.741a2.783 2.783 0 0 0-1.235.069c-1.974.521-3.947 1.041-5.918 1.57-.175.047-.26.015-.355-.144a353.08 353.08 0 0 0-2.421-4.018 4.61 4.61 0 0 0-.652-.849c-.371-.37-.802-.549-1.227-.536zm.172 3.703a.592.592 0 0 1 .189.211c.87 1.446 1.742 2.89 2.609 4.338.07.118.135.16.277.121 1.525-.41 3.052-.813 4.579-1.217.367-.098.735-.193 1.103-.289a.399.399 0 0 1-.1.2c-1.259 1.48-2.516 2.962-3.779 4.438-.11.13-.12.22-.04.37.937 1.803 1.768 3.309 2.498 4.76l-3.696-1.019c-.538-.18-1.077-.358-1.615-.539-.163-.055-.25-.03-.36.1-1.248 1.488-2.504 2.97-3.759 4.454a.398.398 0 0 1-.18.132c.035-.378.068-.757.104-1.136.149-1.572.297-3.144.451-4.716-.03-.318.117-.405-.322-.545-1.493-.593-3.346-1.321-4.816-1.905a.595.595 0 0 1 .24-.134c1.797-.57 3.595-1.14 5.394-1.705.127-.04.199-.092.211-.233.013-.148.05-.294.076-.441.241-1.363.483-2.726.726-4.088.068-.386.14-.771.21-1.157z"/></svg> </a> Calcul Distribué avec Spark </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Introduction </span> <span class="md-nav__icon md-icon"></span> </label> <a href=index.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Introduction </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table des matières"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table des matières </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#objectifs class=md-nav__link> <span class=md-ellipsis> Objectifs </span> </a> </li> <li class=md-nav__item> <a href=#presentation-de-spark class=md-nav__link> <span class=md-ellipsis> Présentation de Spark </span> </a> <nav class=md-nav aria-label="Présentation de Spark"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#architecture-systeme class=md-nav__link> <span class=md-ellipsis> Architecture système </span> </a> </li> <li class=md-nav__item> <a href=#rdds-dataframes-et-datasets class=md-nav__link> <span class=md-ellipsis> RDDs, DataFrames et Datasets </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pyspark class=md-nav__link> <span class=md-ellipsis> Pyspark </span> </a> </li> <li class=md-nav__item> <a href=#preparation-de-lenvironnement class=md-nav__link> <span class=md-ellipsis> Préparation de l'environnement </span> </a> </li> <li class=md-nav__item> <a href=#autres-environnements class=md-nav__link> <span class=md-ellipsis> Autres Environnements </span> </a> <nav class=md-nav aria-label="Autres Environnements"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cloudera-quickstart-vm class=md-nav__link> <span class=md-ellipsis> Cloudera QuickStart VM </span> </a> </li> <li class=md-nav__item> <a href=#cluster-spark-avec-docker class=md-nav__link> <span class=md-ellipsis> Cluster Spark avec Docker </span> </a> </li> <li class=md-nav__item> <a href=#databricks class=md-nav__link> <span class=md-ellipsis> Databricks </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=submitting.html class=md-nav__link> <span class=md-ellipsis> Créer des applications Spark </span> </a> </li> <li class=md-nav__item> <a href=rdd.html class=md-nav__link> <span class=md-ellipsis> Manipuler les RDD </span> </a> </li> <li class=md-nav__item> <a href=sparksql.html class=md-nav__link> <span class=md-ellipsis> SparkSQL </span> </a> </li> <li class=md-nav__item> <a href=streaming.html class=md-nav__link> <span class=md-ellipsis> Spark Streaming </span> </a> </li> <li class=md-nav__item> <a href=solutions.html class=md-nav__link> <span class=md-ellipsis> Solutions </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <p><img src=assets/images/spark.png width=30% height=30%></p> <h1 id=calcul-distribue-avec-spark>Calcul distribué avec Spark<a class=headerlink href=#calcul-distribue-avec-spark title="Permanent link">&para;</a></h1> <hr> <h3 id=objectifs>Objectifs<a class=headerlink href=#objectifs title="Permanent link">&para;</a></h3> <ul> <li>Utiliser Spark sous Hadoop</li> <li>Créer des programmes avec l'API Spark</li> <li>Manipuler les différentes structures de données Spark : RDD, DataFrame</li> <li>Interroger les données avec SparKSQL</li> <li>Traiter des flux de données avec Spark Streaming</li> <li>Créer des pipeline ML</li> </ul> <p><strong>Outils</strong></p> <ul> <li>Image de <a href=https://tinyurl.com/BDToolsiso>machine virtuelle <span class="twemoji heart"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32v242.7l-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7V32zM64 352c-35.3 0-64 28.7-64 64v32c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64v-32c0-35.3-28.7-64-64-64H346.5l-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352H64zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"/></svg></span></a> avec les outils pré-installés. C'est une image créée par Pierre Nezric à laquelle sont ajoutés <strong>jupyter</strong> et <strong>mrjob</strong>. Elle contient les outils suivants :<ul> <li>Hadoop 2.7.3</li> <li>Spark 2.1.1</li> <li>Pig 0.15.0</li> <li>Hive 1.2.1</li> <li>HBase 1.1.9</li> <li>Cassandra </li> <li>Elasticsearch et Kibana</li> <li>Zookeeper 3.4.6</li> </ul> </li> </ul> <p><strong>Sources et références</strong></p> <ul> <li><a href=https://spark.apache.org/docs/latest/index.html>Documentation Spark</a></li> </ul> <h2 id=presentation-de-spark>Présentation de Spark<a class=headerlink href=#presentation-de-spark title="Permanent link">&para;</a></h2> <p>Avec MapReduce, la spécification de l’itération reste à la charge du programmeur; il faut stocker le résultat d’un premier job dans une collection intermédiaire et réiterer le job en prenant la collection intermédiaire comme source. C’est laborieux pour l’implantation, et surtout très peu efficace quand la collection intermédiaire est grande. Le processus de sérialisation/désérialisation sur disque propre à la gestion de la reprise sur panne en MapReduce entraîne des performances médiocres.</p> <p>Dans Spark, la méthode est très différente. Elle consiste à placer ces jeux de données en mémoire RAM et à éviter la pénalité des écritures sur le disque.</p> <p>Spark offre un écosystème de librairies couvrant :</p> <ul> <li>L'apprentissage automatique : <strong>MlLib</strong></li> <li>Données structurés et SQL : <strong>SparkSQL</strong></li> <li>Flux de données : <strong>Spark streaming</strong> et <strong>Spark Structured Streaming</strong></li> <li>Graphes : <strong>GraphX</strong></li> </ul> <p><img src=assets/images/spark-libs.png width=60% height=60%></p> <h3 id=architecture-systeme>Architecture système<a class=headerlink href=#architecture-systeme title="Permanent link">&para;</a></h3> <p>Le programmeur envoie au framework des Spark Applications, pour lesquelles Spark affecte des ressources (RAM, CPU) du cluster en vue de leur exécution. Un executor n’est responsable que de 2 choses : exécuter le code qui lui est assigné par le driver et lui rapporter l’état d’avancement de la tâche.</p> <p>Le driver est accessible programmatiquement par un point d’entrée appelé SparkSession, que l’on trouve derrière une variable spark.</p> <p>Spark est écrit en Scala mais les programmes Spark peuvent être écrits en Scala, Java, Python, SQL et R. Dans ce qui suit, nous utilisons Python à travers la librairie <strong>Pyspark</strong>.</p> <h3 id=rdds-dataframes-et-datasets>RDDs, DataFrames et Datasets<a class=headerlink href=#rdds-dataframes-et-datasets title="Permanent link">&para;</a></h3> <p>La principale innovation apportée par Spark est le concept de Resilient Distributed Dataset (RDD). Un RDD est une collection calculée à partir d’une source de données (liste, fichier, ...) et placée en mémoire RAM. Spark conserve l’historique des opérations qui a permis de constituer un RDD, et la reprise sur panne s’appuie essentiellement sur la préservation de cet historique afin de reconstituer le RDD en cas de panne. </p> <p>Chaque RDD étant fragmentée, une panne affectant un fragment est réparée (par reconstitution de l’historique) indépendamment des autres fragments, évitant d’avoir à tout recalculer.</p> <p>Il est à noter que ces RDD sont immuables et ne peuvent être modifiées après leur création.</p> <p>Les DataFrames et Datasets se situe à un niveau plus haut et reposent sur les RDDs. Il apporte une structure aux données à travers un schéma.</p> <h2 id=pyspark>Pyspark<a class=headerlink href=#pyspark title="Permanent link">&para;</a></h2> <p>PySpark est une bibliothèque Spark écrite en Python pour exécuter une application Python en utilisant les capacités d'Apache Spark, en utilisant PySpark, nous pouvons exécuter des applications en parallèle sur le cluster distribué (plusieurs nœuds).</p> <p>Les modules et packages de pyspark sont :</p> <ul> <li>PySpark RDD (pyspark.RDD)</li> <li>PySpark DataFrame et SQL (pyspark.sql)</li> <li>PySpark Streaming (pyspark.streaming)</li> <li>PySpark MLib (pyspark.ml, pyspark.mllib)</li> <li>PySpark GraphFrames (GraphFrames)</li> <li>PySpark Resource (pyspark.resource)</li> </ul> <h2 id=preparation-de-lenvironnement>Préparation de l'environnement<a class=headerlink href=#preparation-de-lenvironnement title="Permanent link">&para;</a></h2> <ul> <li>En utilisant VirtualBox et à partir du menu Fichier -&gt; Importer un appareil virtuel, sélectionner le fichier <code>BDTools.ova</code> fourni et choisissez l'emplacement de destination.</li> <li>Une fois l'importation finie, vérifier les paramètres de la machine virtuelle pour les ajuster à la configuration de votre machine. Il est recommandé d'utiliser 8G de RAM en gardant au moins 2G pour la machine hôte.</li> <li>Démarrer la machine virtuelle et se connecter avec l'utilisateur <code>uti</code>. Le mot de passe <code>=uti=</code>. Par défaut, les services actifs sont HDFS, YARN et HBase. La commande suivante permet de sélectionner les services nécessaires à Spark pour optimiser la gestion de la mémoire : <div class=highlight><pre><span></span><code>sudo<span class=w> </span>SelectService<span class=w> </span>spark
</code></pre></div></li> </ul> <p><img alt=⚠ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a0.svg title=:warning:> Cette commande peut prendre quelques minutes selon la configuration de votre machine.</p> <p>Lancer le navigateur et aller sur la page <a href=http://localhost>http://localhost</a> où l'état des services est affiché.</p> <h2 id=autres-environnements>Autres Environnements<a class=headerlink href=#autres-environnements title="Permanent link">&para;</a></h2> <p>Plusieurs autres alternatives sont disponibles afin de mettre en place un environnement pour reproduire les tests sur Spark. Deux environnements d'exécution sont présentés ci-après :</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> La machine virtuelle Cloudera QuickStart</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Un cluster Spark de 3 nœuds avec Hadoop</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Databricks cloud (version d'essai)</li> </ul> <h3 id=cloudera-quickstart-vm>Cloudera QuickStart VM<a class=headerlink href=#cloudera-quickstart-vm title="Permanent link">&para;</a></h3> <p><strong>Machine Virtuelle</strong></p> <p>Les étapes sont simples. Il suffit de :</p> <p><img alt=1⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/31-20e3.svg title=:one:> Télécharger l'image de la machine qui convient à votre logiciel de virtualisation (<a href=https://download.virtualbox.org/virtualbox/6.1.16/VirtualBox-6.1.16-140961-Win.exe>Oracle Virtual Box V6.1</a> ou Vmware) :</p> <ul> <li>Image Cloudera QuickStart 5.13 :</li> <li><a href=https://downloads.cloudera.com/demo_vm/virtualbox/cloudera-quickstart-vm-5.13.0-0-virtualbox.zip>pour VirtualBox</a></li> <li><a href=https://downloads.cloudera.com/demo_vm/vmware/cloudera-quickstart-vm-5.13.0-0-vmware.zip>pour vmware</a></li> </ul> <p><img alt=2⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/32-20e3.svg title=:two:> Ensuite, décompresser puis importer l'image <code>.ovf</code> à partir du logiciel de virtualisation.</p> <p><img alt=3⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/33-20e3.svg title=:three:> Enfin, démarrer la machine qui est sous Centos 6.</p> <p><strong>Docker</strong></p> <p>Si vous préférez docker alors :</p> <p><img alt=1⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/31-20e3.svg title=:one:> Charger l'image docker :</p> <ul> <li>Option 1 :</li> </ul> <div class=highlight><pre><span></span><code>docker<span class=w> </span>pull<span class=w> </span>cloudera/quickstart:latest
</code></pre></div> <ul> <li>Option 2 : télécharger <a href=https://downloads.cloudera.com/demo_vm/docker/cloudera-quickstart-vm-5.13.0-0-beta-docker.tar.gz>l'image docker</a> et la charger avec :</li> </ul> <div class=highlight><pre><span></span><code>docker<span class=w> </span>load<span class=w> </span>&lt;<span class=w> </span>cloudera.tar.gz
</code></pre></div> <p><img alt=2⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/32-20e3.svg title=:two:> Démarrer le container :</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span>run<span class=w> </span>-m<span class=w> </span>4G<span class=w> </span>--memory-reservation<span class=w> </span>2G<span class=w> </span>--memory-swap<span class=w> </span>8G<span class=w> </span>--hostname<span class=o>=</span>quickstart.cloudera<span class=w> </span>--privileged<span class=o>=</span><span class=nb>true</span><span class=w> </span>-t<span class=w> </span>-i<span class=w> </span>--publish-all<span class=o>=</span><span class=nb>true</span><span class=w> </span>-p8888<span class=w> </span>-p8088<span class=w> </span>cloudera/quickstart<span class=w> </span>/usr/bin/docker-quickstart
</code></pre></div> <h3 id=cluster-spark-avec-docker>Cluster Spark avec Docker<a class=headerlink href=#cluster-spark-avec-docker title="Permanent link">&para;</a></h3> <p>Créer un cluster Spark composé de 3 nœuds.</p> <p><img alt=1⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/31-20e3.svg title=:one:> Télécharger et décompresser l'archive <a href=assets/spark-lab.zip>spark-lab.zip</a></p> <details class=info open=open> <summary>spark-lab.zip</summary> <p>Cette archieve contient :</p> <p><code>cluster.sh</code> : script pour la gestion du cluster sous Linux</p> <p><code>cluster.ps1</code> : script pour la gestion du cluster pour Windows Powershell</p> <p><code>spark-apps</code> : dossier contenant l'exemple wordcount. Il est sera monté comme un volume pour docker.</p> </details> <p><img alt=2⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/32-20e3.svg title=:two:> Charger l'image docker</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span>pull<span class=w> </span>hhmida/sparkbase
</code></pre></div> <p><img alt=3⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/33-20e3.svg title=:three:> Déployer le cluster</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Shell Linux</label><label for=__tabbed_1_2>Windows Powershell</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>./cluster.sh<span class=w> </span>deploy
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>cluster.ps1 deploy
</code></pre></div> </div> </div> </div> <details class=hint open=open> <summary><strong>Options du script</strong></summary> <div class=highlight><pre><span></span><code>cluster.sh<span class=w> </span>stop<span class=w>   </span><span class=c1># Arrêter les containers </span>
cluster.sh<span class=w> </span>start<span class=w>  </span><span class=c1># Démarrer les containers</span>
cluster.sh<span class=w> </span>info<span class=w>   </span><span class=c1># Montre les URLs pour accéder aux services</span>
cluster.sh<span class=w> </span>deploy<span class=w> </span><span class=c1># Formater le cluster et redéployer</span>
</code></pre></div> </details> <p><strong>Vu que les ports sont publiés sur la machine hôte, <code>localhost</code> peut être utilisé avec les URLs des services.</strong></p> <h3 id=databricks>Databricks<a class=headerlink href=#databricks title="Permanent link">&para;</a></h3> <p><img alt=🚧 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f6a7.svg title=:construction:></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Retour en haut de la page </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label="Pied de page"> <a href=submitting.html class="md-footer__link md-footer__link--next" aria-label="Suivant: Créer des applications Spark"> <div class=md-footer__title> <span class=md-footer__direction> Suivant </span> <div class=md-ellipsis> Créer des applications Spark </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022 - Dr. Hmida Hmida </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://gitlab.com/hhmida target=_blank rel=noopener title=gitlab.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81-2.9-.295-5.7.083-8.4 1.11-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.09 18.09 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3 4.7 0 9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82z"/></svg> </a> <a href=https://github.com/hhmida target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://linkedin.com/in/hhmida target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": ".", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.instant.progress", "navigation.top", "toc.integrate", "content.code.annotate", "content.code.copy", "navigation.footer"], "search": "assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}}</script> <script src=assets/javascripts/bundle.8fd75fb4.min.js></script> </body> </html>